var n=Object.defineProperty,e=Object.defineProperties,a=Object.getOwnPropertyDescriptors,t=Object.getOwnPropertySymbols,o=Object.prototype.hasOwnProperty,s=Object.prototype.propertyIsEnumerable,c=(e,a,t)=>a in e?n(e,a,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[a]=t,i=(n,e)=>{for(var a in e||(e={}))o.call(e,a)&&c(n,a,e[a]);if(t)for(var a of t(e))s.call(e,a)&&c(n,a,e[a]);return n},r=(n,t)=>e(n,a(t));import{Q as l,C as p}from"./vendor-e24d3430.js";const u={chats:[],connection:"disconnected",ship:window.ship,name:`~${window.ship}/welcome`,radius:10,gcp:null,s3:{configuration:{buckets:new Set,currentBucket:""},credentials:null},leaving:!1},{subscribe:v,update:d}=p(u);function f(n){console.log("[createCanvasStore]",n);const[e,a]=function(n){const e=[],a=[];return Object.entries(n).map((([n,t])=>{t.metadata.private?e.push(n):a.push(n)})),[e,a]}(n);d((t=>r(i({},t),{canvas:n,privateCanvas:e,publicCanvas:a})))}function b(n){(function(n){return"string"==typeof n.accessKey&&"number"==typeof n.expiresIn})(n)&&(console.log("[loadGCPToken]"),d((e=>r(i({},e),{gcp:{gcpToken:n}}))))}function g(n){console.log("[loadS3Creds]");const e=-1!==n.endpoint.search("http://")?n.endpoint:`https://${n.endpoint}`;console.log(e),d((a=>r(i({},a),{s3:r(i({},a.s3),{credentials:n,client:new l({credentials:n,endpoint:e,region:"us-east-1"})})})))}function m(n){console.log("[loadS3Config]"),d((e=>r(i({},e),{s3:r(i({},e.s3),{configuration:n})})))}function C(n){const e=`${n.location}/${n.name}`;console.log("[loadCanvas]",n,n.name),d((a=>r(i({},a),{canvas:i({[e]:{metadata:i({},n),data:n.data}},a.canvas),publicCanvas:n.private?a.publicCanvas:[e,...a.publicCanvas],privateCanvas:n.private?[e,...a.privateCanvas]:a.privateCanvas,name:e,leaving:!1})))}function h(n){console.log("[painting]",n),d((e=>{const a=`${n.location}/${n.name}`;return n.strokes.forEach((n=>{e.canvas[a].data[n.id]=i({},n)})),e}))}function w(n){d((e=>r(i({},e),{connection:n})))}function y(n){d((e=>r(i({},e),{api:n})))}function O(n){d((e=>r(i({},e),{subscription:n})))}function j(n){d((e=>r(i({},e),{name:n})))}function $(n,e){d((a=>{const t=`${n}/${e}`;return delete a.canvas[t],r(i({},a),{leaving:!0,publicCanvas:a.publicCanvas.filter((n=>n!==t))})}))}var P={subscribe:v};export{g as a,m as b,f as c,P as d,y as e,O as f,$ as g,j as h,C as l,h as p,b as s,w as u};
